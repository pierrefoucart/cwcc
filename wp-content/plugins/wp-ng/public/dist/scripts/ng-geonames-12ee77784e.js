!function(e){"use strict";e.module("ngGeonames",[]).service("geonamesHelpers",["$q","$log","$timeout",function(n,t,r){function o(n,r){var o,s;if(e.isDefined(r))o=r;else if(0===Object.keys(n).length)o="mainGeonames";else if(Object.keys(n).length>=1)for(s in n)n.hasOwnProperty(s)&&(o=s);else t.error(a+"- You have more than 1 geonames on the DOM, you must provide the geonames ID to the geonamesData.getXXX call");return o}function s(t,r){var s,a=o(t,r);return e.isDefined(t[a])&&!0!==t[a].resolvedDefer?s=t[a].defer:(s=n.defer(),t[a]={defer:s,resolvedDefer:!1}),s}var a="[ng-geonames] ",i=function(n){return e.isString(n)&&""!==n},u=function(n){return e.isDefined(n)&&null!==n},c=function(e){return!u(e)};return{isTruthy:function(e){return"true"===e||!0===e},isEmpty:function(e){return 0===Object.keys(e).length},isUndefinedOrEmpty:function(n){return e.isUndefined(n)||null===n||0===Object.keys(n).length},isDefined:u,isUndefined:c,isNumber:e.isNumber,isString:i,isArray:e.isArray,isObject:e.isObject,isFunction:e.isFunction,equals:e.equals,getUnresolvedDefer:s,setResolvedDefer:function(e,n){e[o(e,n)].resolvedDefer=!0},obtainEffectiveGeonamesId:o}}])}(window.angular),function(e){"use strict";e.module("ngGeonames").factory("geonamesDefaults",["$q","geonamesHelpers",function(e,n){function t(){return{server:"http://api.geonames.org",maxRows:50,postalCode:!1,country:[],username:"demo"}}var r=n.isDefined,o=(n.isObject,n.obtainEffectiveGeonamesId),s={};return{reset:function(e){var n=o(s,e);"mainGeonames"!==n&&delete s[n]},getDefaults:function(e){var n=o(s,e);return s[n]},getGeonamesCreationDefaults:function(e){var n=o(s,e),t=s[n];return{server:t.server,maxRows:t.maxRows,postalCode:t.postalCode,country:t.country,username:t.username}},setDefaults:function(e,n){var a=t();r(e)&&(a.server=r(e.server)?e.server:a.server,a.maxRows=r(e.maxRows)?e.maxRows:a.maxRows,a.postalCode=r(e.postalCode)?e.postalCode:a.postalCode,a.country=r(e.country)?e.country:a.country,a.username=r(e.username)?e.username:a.username);var i=o(s,n);return s[i]=a,a}}}])}(window.angular),function(e){"use strict";e.module("ngGeonames").service("geonamesData",["$q","$log","geonamesHelpers",function(e,n,t){var r=t.getDefer,o=t.getUnresolvedDefer,s=t.setResolvedDefer,a={},i=this,u=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},c=["geonames"];c.forEach(function(e){a[e]={}}),this.unresolveGeonames=function(e){var n=t.obtainEffectiveGeonamesId(a.geonames,e);c.forEach(function(e){a[e][n]=void 0})},c.forEach(function(e){var n=u(e);i["set"+n]=function(n,t){o(a[e],t).resolve(n),s(a[e],t)},i["get"+n]=function(n){return r(a[e],n).promise}})}])}(window.angular),function(e){"use strict";e.module("ngGeonames").factory("geonamesService",["$log","$q","$http","geonamesHelpers","geonamesDefaults",function(n,t,r,o,s){var a=o.isDefined,i=e.isString,u=o.equals;return{query:function(o,c){var m=s.getDefaults(c),l=m.server,f=m.maxRows,d=m.postalCode,g=m.country,v=m.username,p=t.defer(),h=[],y=null,D={method:"JSONP",url:l,params:{},cancellable:!0};return a(o.q)&&i(o.q)&&""!==o.q&&(!0===d?(D.url+="/postalCodeLookupJSON",D.params.postalcode=o.q,y="postalcodes"):(D.url+="/searchJSON",D.params.q=o.q,y="geonames"),a(o.country)&&i(o.country)&&""!==o.country&&(g=o.country)),a(D.params)&&!u({},D.params)?(e.extend(D.params,{maxRows:f,country:g,username:v,callback:"JSON_CALLBACK"}),r(D).success(function(n){a(n[y])?(e.forEach(n[y],function(e,n){switch(y){case"postalcodes":a(e.title)||(e.title="["+e.postalcode+"] "),a(e.locationName)||(e.locationName=e.countryCode+" "+e.placeName);break;case"geonames":a(e.title)||(e.title=e.name),a(e.locationName)||(e.locationName=e.countryName)}this.push(e)},h),p.resolve(h)):p.reject("[Geonames] Invalid query: "+n.status.message)})):(p.reject("[Geonames] Invalid query params"),n.error(D)),p.promise}}}])}(window.angular),function(e){"use strict";e.module("ngGeonames").directive("geonames",["$q","geonamesData","geonamesDefaults","geonamesHelpers",function(e,n,t,r){return{restrict:"AE",replace:!1,scope:{defaults:"=",search:"=",id:"@"},transclude:!0,template:'<div class="angular-geonames"><div ng-transclude></div></div>',controller:["$scope",function(n){this._geonames=e.defer(),this.getGeonames=function(){return this._geonames.promise},this.getScope=function(){return n}}],link:function(e,r,o,s){n.isDefined,t.setDefaults(e.defaults,o.id);e.geonamesId=o.id;var a=t.getGeonamesCreationDefaults(o.id);s._geonames.resolve(a),n.setGeonames(a,o.id),e.$on("$destroy",function(){t.reset(o.id),n.unresolveGeonames(o.id)})}}}])}(window.angular),function(e){"use strict";e.module("ngGeonames").directive("search",["$log","$timeout","$http","geonamesHelpers","geonamesService",function(e,n,t,r,o){return{restrict:"A",scope:!1,replace:!1,require:["geonames"],link:function(t,s,a,i){var u=r.isDefined,c=r.isString,m=i[0].getScope();i[0].getGeonames().then(function(r){var s;m.$watch("search",function(r){if(!t.settingSearchFromGeonames)return u(r.q)&&c(r.q)&&""!==r.q&&r.q!==s?(t.settingSearchFromScope=!0,t.$broadcast("geonamesDirectiveSearch.find_start"),o.query(r,a.id).then(function(e){r.find=e,t.$broadcast("geonamesDirectiveSearch.find_end",e)},function(n){r.find=[],t.$broadcast("geonamesDirectiveSearch.find_end",[]),e.error("[ng-geonames]  [Search]  "+n+".")}),s=r.q,void n(function(){t.settingSearchFromScope=!1})):void 0},!0)})}}}])}(window.angular);