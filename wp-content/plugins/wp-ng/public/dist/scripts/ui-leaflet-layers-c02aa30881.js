function putAJAXMarker(e,t,n,i,o){var a,r=i.split(/<hr \/>/),s=[],l=[],u=[],p=null,h=0;for(a=0;a<r.length;a++)p=null,h=0,r[a]=r[a].replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),h=r[a].lastIndexOf("["),h>0?(s[a]=r[a].substr(0,h-1),p=r[a].substr(h+1),l[a]=p.substr(0,p.lastIndexOf(",")),u[a]=p.substr(p.lastIndexOf(",")+2),u[a]=u[a].substr(0,u[a].lastIndexOf("]"))):s[a]=r[a];var c=putAJAXMarker.bugs[e];putAJAXMarker.bugs[e]=[new L.LatLng(n,t),r,o,i,s,l,u];var d=(c&&c[3])!==i;for(a=0;a<putAJAXMarker.layers.length;a++)putAJAXMarker.layers[a].createMarker(e,d)}function osbResponse(e){e&&alert("Error: "+e)}L.Control.Distance=L.Control.extend({options:{position:"topleft",popups:!0},initialize:function(e){L.Util.setOptions(this,e),this._line=new L.Polyline([],{editable:!0}),this._line.on("edit",this._update,this),this._active=!1},getLine:function(){return this._line},onAdd:function(){function e(){this._active?this._calc_disable():this._calc_enable()}var t=this._container=L.DomUtil.create("div","leaflet-control-distance");return this._link=this._createButton("Edit","leaflet-control-distance leaflet-control-distance-edit",t,e,this),this._link_delete=this._createButton("Delete","leaflet-control-distance leaflet-control-distance-delete",t,this._reset,this),this._text=L.DomUtil.create("div","leaflet-control-distance-text",t),this._map.addLayer(this._line),this._calc_disable(),t},_createButton:function(e,t,n,i,o){var a=L.DomUtil.create("a",t,n);return a.href="#",a.title=e,L.DomEvent.addListener(a,"click",L.DomEvent.stopPropagation).addListener(a,"click",L.DomEvent.preventDefault).addListener(a,"click",i,o),a},onRemove:function(){this._calc_disable()},_calc_enable:function(){this._map.on("click",this._add_point,this),this._map.getContainer().style.cursor="crosshair",L.DomUtil.addClass(this._link,"leaflet-control-distance-active"),this._container.appendChild(this._link_delete),this._container.appendChild(this._text),this._active=!0,this._line.editing.enable(),this._map.hasLayer(this._line)||this._map.addLayer(this._line),this._update()},_calc_disable:function(){this._map.off("click",this._add_point,this),this._map.getContainer().style.cursor="default",this._container.removeChild(this._link_delete),this._container.removeChild(this._text),L.DomUtil.removeClass(this._link,"leaflet-control-distance-active"),this._active=!1,this._line.editing.disable()},_add_point:function(e){this._line.addLatLng(e.latlng),this._line.editing.updateMarkers(),this._line.fire("edit",{})},_reset:function(){this._line.setLatLngs([]),this._line.fire("edit",{}),this._line.redraw(),this._line.editing.updateMarkers()},_update:function(){this._text.textContent=this._d2txt(this._distance_calc())},_d2txt:function(e){return e<2e3?e.toFixed(0)+" m":(e/1e3).toFixed(1)+" km"},_distance_calc:function(){for(var e=this._line.getLatLngs(),t=0,n=null,i=0;i<e.length;i++){if(i&&(t+=n.distanceTo(e[i])),this.options.popups){var o=this._line.editing._markers[i];o&&(o.bindPopup(this._d2txt(t)),o.on("mouseover",o.openPopup,o),o.on("mouseout",o.closePopup,o))}n=e[i]}return t}}),L.Control.Layers.include({_loadScripts:function(e,t,n){function i(){a._loadScripts(e,t,n)}if(!e||0===e.length)return t(n);var o,a=this,r=e.pop();if(void 0===(o=L.Control.Layers._script_cache[r])){o={url:r,wait:[]};var s=document.createElement("script");s.src=r,s.type="text/javascript",s.onload=function(){var e=0;for(e=0;e<o.wait.length;e++)o.wait[e]()},o.e=s,document.getElementsByTagName("head")[0].appendChild(s)}o.wait.push(i),"completed"===o.e.readyState&&i(),L.Control.Layers._script_cache[r]=o},addLayerDef:function(e,t){void 0===this._layer_defs&&(this._layer_defs={}),this._layer_defs[e]=t},addLayerDefs:function(e){void 0===this._layer_defs&&(this._layer_defs={}),L.Util.extend(this._layer_defs,e)},loadLayer:function(e,t){var n=this,i=this._layer_defs[e];i.default=t,this._loadScripts(i.js.reverse(),function(e){n._loadLayer(e)},i)},_loadLayer:function(e){var t=e.init();e.default&&this._map&&this._map.addLayer(t),e.overlay?this.addOverlay(t,e.name):this.addBaseLayer(t,e.name)}}),L.Control.Layers._script_cache={},L.Control.Permalink=L.Control.extend({includes:L.Mixin.Events,options:{position:"bottomleft",useAnchor:!0,useLocation:!1,useLocalStorage:!1,text:"Permalink"},initialize:function(e){L.Util.setOptions(this,e),this._params={},this._set_urlvars(),this.on("update",this._set_center,this);for(var t in this)"string"==typeof t&&0===t.indexOf("initialize_")&&this[t]()},onAdd:function(e){if(this._container=L.DomUtil.create("div","leaflet-control-attribution leaflet-control-permalink"),L.DomEvent.disableClickPropagation(this._container),this._map=e,this._href=L.DomUtil.create("a",null,this._container),this._href.innerHTML=this.options.text,e.on("moveend",this._update_center,this),this.fire("update",{params:this._params}),this._update_center(),this.options.useAnchor&&"onhashchange"in window){var t=this,n=window.onhashchange;window.onhashchange=function(){if(t._set_urlvars(),n)return n()}}return this.fire("add",{map:e}),this._container},_update_center:function(){if(this._map){var e=this._round_point(this._map.getCenter());this._update({zoom:String(this._map.getZoom()),lat:String(e.lat),lon:String(e.lng)})}},_update_href:function(){var e=L.Util.getParamString(this._params),t="?";this.options.useAnchor&&(t="#");var n=this._url_base+t+e.slice(1);return this._href&&this._href.setAttribute("href",n),this.options.useLocation&&location.replace("#"+e.slice(1)),this.options.useLocalStorage&&window.localStorage.setItem("paramsTemp",e.slice(1)),n},_round_point:function(e){var t=this._map.getBounds(),n=this._map.getSize(),i=t.getNorthEast(),o=t.getSouthWest(),a=function(e,t){if(0===t)return e;for(var n=1;t<1&&t>-1;)e*=10,t*=10,n*=10;return Math.floor(e)/n};return e.lat=a(e.lat,(i.lat-o.lat)/n.y),e.lng=a(e.lng,(i.lng-o.lng)/n.x),e},_update:function(e){for(var t in e)e.hasOwnProperty(t)&&(null!==e[t]&&void 0!==e[t]?this._params[t]=e[t]:delete this._params[t]);this._update_href()},_set_urlvars:function(){function e(e,t){for(var n in e)if(e.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}var t;this.options.useAnchor?(t=L.UrlUtil.queryParse(L.UrlUtil.hash()),this._url_base=window.location.href.split("#")[0]):(t=L.UrlUtil.queryParse(L.UrlUtil.query()),this._url_base=window.location.href.split("#")[0].split("?")[0]),this.options.useLocalStorage&&(t=window.localStorage.getItem("paramsTemp"),t=null!==t?L.UrlUtil.queryParse(t):{}),e(t,this._params)&&e(this._params,t)||(this._params=t,this._update_href(),this.fire("update",{params:this._params}))},_set_center:function(e){var t=e.params;void 0!==t.zoom&&void 0!==t.lat&&void 0!==t.lon&&this._map.setView(new L.LatLng(t.lat,t.lon),t.zoom)}}),L.UrlUtil={queryParse:function(e){var t={},n="&";-1!==e.search("&amp;")&&(n="&amp;");for(var i=e.split(n),o=0;o<i.length;o++){var a=i[o].split("=");2===a.length&&(t[a[0]]=decodeURIComponent(a[1]))}return t},query:function(){var e=window.location.href.split("#")[0],t=e.indexOf("?");return t<0?"":e.slice(t+1)},hash:function(){return window.location.hash.slice(1)},updateParamString:function(e,t){var n=L.UrlUtil.queryParse(e);for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return L.Util.getParamString(n).slice(1)}},L.Control.Permalink.include({initialize_layer:function(){this.on("update",this._set_layer,this),this.on("add",this._onadd_layer,this)},_onadd_layer:function(){this._map.on("layeradd",this._update_layer,this),this._map.on("layerremove",this._update_layer,this),this._update_layer()},_update_layer:function(){if(this.options.layers){var e=this.options.layers.currentBaseLayer();e&&this._update({layer:e.name})}},_set_layer:function(e){var t=e.params;this.options.layers&&t.layer&&this.options.layers.chooseBaseLayer(t.layer)}}),L.Control.Layers.include({chooseBaseLayer:function(e){var t,n;for(var i in this._layers)this._layers.hasOwnProperty(i)&&(n=this._layers[i],n.overlay||n.name!==e||(t=n.layer));if(t&&!this._map.hasLayer(t)){for(var o in this._layers)this._layers.hasOwnProperty(o)&&(n=this._layers[o],!n.overlay&&this._map.hasLayer(n.layer)&&this._map.removeLayer(n.layer));this._map.addLayer(t),this._update()}},currentBaseLayer:function(){for(var e in this._layers)if(this._layers.hasOwnProperty(e)){var t=this._layers[e];if(!t.overlay&&!t.overlay&&this._map.hasLayer(t.layer))return t}}}),L.Control.Permalink.include({initialize_line:function(){this.on("update",this._set_line,this),this.on("add",this._onadd_line,this)},_onadd_line:function(){this.options.line&&(this.options.line.on("edit",this._update_line,this),this._update_line())},_update_line:function(){if(this.options.line){var e=this.options.line;if(e){var t=[],n=e.getLatLngs();if(!n.length)return this._update({line:null});for(var i in n)t.push(n[i].lat.toFixed(4)+","+n[i].lng.toFixed(4));this._update({line:t.join(";")})}}},_set_line:function(e){var t=e.params,n=this.options.line;if(n&&t.line){var i=[],o=t.line.split(";");for(var a in o){var r=o[a].split(",");2===r.length&&i.push(new L.LatLng(r[0],r[1]))}i.length&&(n.setLatLngs(i),this._map.hasLayer(n)||this._map.addLayer(n))}}}),L.Control.Permalink.include({initialize_marker:function(){this.on("update",this._set_marker,this)},_set_marker:function(e){var t=e.params;if(!this._marker&&1===t.marker){if(void 0!==t.mlat&&void 0!==t.mlon)return this._update({mlat:null,mlon:null,lat:t.mlat,lon:t.mlon,marker:1});this._marker=new L.Marker(new L.LatLng(t.lat,t.lon),this.options.markerOptions),this._marker.bindPopup('<a href="'+this._update_href()+'">'+this.options.text+"</a>"),this._map.addLayer(this._marker),this._update({marker:null})}}}),L.Control.Permalink.include({initialize_overlay:function(){this.on("update",this._set_overlays,this),this.on("add",this._onadd_overlay,this)},_onadd_overlay:function(){this._map.on("overlayadd",this._update_overlay,this),this._map.on("overlayremove",this._update_overlay,this),this._update_overlay()},_update_overlay:function(){if(this.options.layers){var e=this.options.layers.overlayFlags();e&&""!==e&&this._update({overlays:e})}},_set_overlays:function(e){var t=e.params;this.options.layers&&t.overlays&&this.options.layers.setOverlays(t.overlays)}}),L.Control.Layers.include({setOverlays:function(e){var t,n=0;for(var i in this._layers)if(this._layers.hasOwnProperty(i)&&(t=this._layers[i],t.overlay)){var o=n>=e.length||"T"===e[n];n++,!o&&this._map.hasLayer(t.layer)?this._map.removeLayer(t.layer):o&&!this._map.hasLayer(t.layer)&&this._map.addLayer(t.layer)}},overlayFlags:function(){var e="";for(var t in this._layers)if(this._layers.hasOwnProperty(t)){var n=this._layers[t];n.overlay&&n.overlay&&(this._map.hasLayer(n.layer)?e+="T":e+="F")}return e}}),L.Icon.Canvas=L.Icon.extend({options:{iconSize:new L.Point(20,20),className:"leaflet-canvas-icon"},createIcon:function(){var e=document.createElement("canvas");this._setIconStyles(e,"icon");var t=this.options.iconSize;return e.width=t.x,e.height=t.y,this.draw(e.getContext("2d"),t.x,t.y),e},createShadow:function(){return null}}),L.DeferredLayer=L.LayerGroup.extend({options:{js:[],init:null},_script_cache:{},initialize:function(e){L.Util.setOptions(this,e),L.LayerGroup.prototype.initialize.apply(this),this._loaded=!1},onAdd:function(e){if(L.LayerGroup.prototype.onAdd.apply(this,[e]),!this._loaded){var t=function(){this._loaded=!0;var e=this.options.init();e&&this.addLayer(e)};this._loadScripts(this.options.js.reverse(),L.Util.bind(t,this))}},_loadScripts:function(e,t,n){function i(){a._loadScripts(e,t,n)}if(!e||0===e.length)return t(n);var o,a=this,r=e.pop();if(void 0===(o=this._script_cache[r])){o={url:r,wait:[]};var s=document.createElement("script");s.src=r,s.type="text/javascript",s.onload=function(){o.e.readyState="completed";var e=0;for(e=0;e<o.wait.length;e++)o.wait[e]()},o.e=s,document.getElementsByTagName("head")[0].appendChild(s)}o.wait.push(i),"completed"===o.e.readyState&&i(),this._script_cache[r]=o}}),function(){var e=L.Marker.prototype._setPos;L.Marker.include({_updateImg:function(e,t,n){t=L.point(n).divideBy(2)._subtract(L.point(t));var i="";i+=" translate("+-t.x+"px, "+-t.y+"px)",i+=" rotate("+this.options.iconAngle+"deg)",i+=" translate("+t.x+"px, "+t.y+"px)",e.style[L.DomUtil.TRANSFORM]+=i},_getShortestEndDegree:function(e,t){var n=Math.abs(t-e),i=t-e>=0;return n<=180?t:e+(360-n)*(i?-1:1)},setIconAngle:function(e){this.options.iconAngle=this._getShortestEndDegree(this.options.iconAngle||0,e),this._map&&this.update()},_setPos:function(t){if(this._icon&&(this._icon.style[L.DomUtil.TRANSFORM]=""),this._shadow&&(this._shadow.style[L.DomUtil.TRANSFORM]=""),e.apply(this,[t]),this.options.iconAngle){var n,i=new L.Icon.Default,o=this.options.icon.options.iconAnchor||i.options.iconAnchor,a=this.options.icon.options.iconSize||i.options.iconSize;this._icon&&(n=this._icon,this._updateImg(n,o,a)),this._shadow&&(this.options.icon.options.shadowAnchor&&(o=this.options.icon.options.shadowAnchor),a=this.options.icon.options.shadowSize,n=this._shadow,this._updateImg(n,o,a))}}})}(),L.Icon.Text=L.Icon.extend({initialize:function(e,t){this._text=e,L.Icon.prototype.initialize.apply(this,[t])},createIcon:function(){var e=document.createElement("div");return e.appendChild(document.createTextNode(this._text)),this._setIconStyles(e,"icon"),e.style.textShadow="2px 2px 2px #fff",e},createShadow:function(){return null}}),L.Marker.Text=L.Marker.extend({initialize:function(e,t,n){L.Marker.prototype.initialize.apply(this,[e,n]),this._fakeicon=new L.Icon.Text(t)},_initIcon:function(){L.Marker.prototype._initIcon.apply(this);var e=this._icon,t=this._shadow,n=this.options.icon;this._icon=this._shadow=null,this.options.icon=this._fakeicon,L.Marker.prototype._initIcon.apply(this),this.options.icon=n,t&&(t.parentNode.removeChild(t),this._icon.appendChild(t)),e.parentNode.removeChild(e),this._icon.appendChild(e);var i=this._icon.clientWidth,o=this._icon.clientHeight;this._icon.style.marginLeft=-i/2+"px";var a=new L.Point(i/2,0);L.Browser.webkit&&(a.y=-o),L.DomUtil.setPosition(e,a),t&&L.DomUtil.setPosition(t,a)}}),L.OpenStreetBugs=L.FeatureGroup.extend({options:{serverURL:"http://openstreetbugs.schokokeks.org/api/0.1/",readonly:!1,setCookie:!0,username:"NoName",cookieLifetime:1e3,cookiePath:null,permalinkZoom:14,permalinkUrl:null,opacity:.7,showOpen:!0,showClosed:!0,iconOpen:"http://openstreetbugs.schokokeks.org/client/open_bug_marker.png",iconClosed:"http://openstreetbugs.schokokeks.org/client/closed_bug_marker.png",iconActive:void 0,editArea:.01,popupOptions:{autoPan:!1},dblClick:!0},initialize:function(e){var t=L.Util.extend({},this.options.popupOptions,(e||{}).popupOptions);L.Util.setOptions(this,e),this.options.popupOptions=t,putAJAXMarker.layers.push(this),this.bugs={},this._layers={};var n=this.get_cookie("osbUsername");n&&(this.options.username=n),L.OpenStreetBugs.setCSS()},onAdd:function(e){L.FeatureGroup.prototype.onAdd.apply(this,[e]),this._map.on("moveend",this.loadBugs,this),this.loadBugs(),this.options.readonly||(this.options.dblClick?(e.doubleClickZoom.disable(),e.on("dblclick",this.addBug,this)):e.on("click",this.addBug,this)),this.fire("add")},onRemove:function(e){this._map.off("moveend",this.loadBugs,this),this._iterateLayers(e.removeLayer,e),delete this._map,this.options.readonly||(this.options.dblClick?(e.doubleClickZoom.enable(),e.off("dblclick",this.addBug,this)):e.off("click",this.addBug,this)),this.fire("remove")},set_cookie:function(e,t){new Date((new Date).getTime()+6048e5).toGMTString();document.cookie=e+"="+encodeURIComponent(t)+";"},get_cookie:function(e){for(var t=(document.cookie||"").split(/;\s*/),n=0;n<t.length;n++){var i=t[n].split("=");if(i[0]===e)return decodeURIComponent(i[1])}return null},loadBugs:function(){function e(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var t=this._map.getBounds();if(!t)return!1;var n=t.getSouthWest(),i=t.getNorthEast();this.apiRequest("getBugs?t="+e(i.lat,5)+"&r="+e(i.lng,5)+"&b="+e(n.lat,5)+"&l="+e(n.lng,5))},apiRequest:function(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=this.options.serverURL+e+"&nocache="+(new Date).getTime();var i=this;n.onload=function(e){document.body.removeChild(this),t&&i.loadBugs()},document.body.appendChild(n)},createMarker:function(e,t){var n=putAJAXMarker.bugs[e];if(this.bugs[e]){if(!t&&this.bugs[e].osb.closed===n[2])return;this.removeLayer(this.bugs[e])}var i=n[2];if((!i||this.options.showClosed)&&(i||this.options.showOpen)){var o=null,a=" osb";n[2]?(o=this.options.iconClosed,a+=" osbClosed"):1===n[1].length?(o=this.options.iconOpen,a+=" osbOpen"):this.options.iconActive?(o=this.options.iconActive,a+=" osbActive"):(o=this.options.iconOpen,a+=" osbOpen");var r=new L.Marker(n[0],{icon:new this.osbIcon({iconUrl:o})});r.osb={id:e,closed:i},this.addLayer(r),this.bugs[e]=r,this.setPopupContent(e),r._popup.options.className+=a,this.options.bugid&&parseInt(this.options.bugid)===e&&r.openPopup()}},osbIcon:L.Icon.extend({options:{iconUrl:"http://openstreetbugs.schokokeks.org/client/open_bug_marker.png",iconSize:new L.Point(22,22),shadowSize:new L.Point(0,0),iconAnchor:new L.Point(11,11),popupAnchor:new L.Point(0,-11)}}),setPopupContent:function(e){function t(e,t){var n=L.DomUtil.create("a",null,L.DomUtil.create("li",null,e));return n.href="#",n.textContent=L.i18n(t),n}function n(t,n){r.textContent_old=r.textContent,r.textContent=L.i18n(t);var i=d.createCommentForm();return i.osbid.value=e,i.cancel.onclick=function(e){r.textContent=r.textContent_old,a.removeChild(i),a.appendChild(c)},i.ok.onclick=function(e){return f.closePopup(),n?d.submitComment(i):d.closeBug(i),!1},a.appendChild(i),a.removeChild(c),!1}if(!this.bugs[e]._popup_content){var i=putAJAXMarker.bugs[e],o=i[2],a=L.DomUtil.create("div","osb-popup"),r=L.DomUtil.create("h1",null,a);i[2]?r.textContent=L.i18n("Fixed Error"):1===i[1].length?r.textContent=L.i18n("Unresolved Error"):r.textContent=L.i18n("Active Error");for(var s=L.DomUtil.create("div","osb-info",a),l=L.DomUtil.create("table","osb-table",s),u=0;u<i[1].length;u++){var p=L.DomUtil.create("tr","osb-tr-info",l);p.setAttribute("valign","top");L.DomUtil.create("td","osb-td-nickname",p).textContent=i[5][u]+":";L.DomUtil.create("td","osb-td-datetime",p).textContent=i[6][u];var h=L.DomUtil.create("td","osb-td-comment",L.DomUtil.create("tr","osb-tr-comment",l));h.setAttribute("colspan","2"),h.setAttribute("charoff","2"),h.textContent=i[4][u]}var c=L.DomUtil.create("ul",null,a),d=this,f=this.bugs[e];if(!o&&!this.options.readonly){var g;g=t(c,"Add comment"),g.onclick=function(e){return n("Add comment",!0)},g=t(c,"Mark as Fixed"),g.onclick=function(e){return n("Close bug",!1)}}t(c,"JOSM").onclick=function(){d.remoteEdit(i[0])};var m=t(c,"Link"),y={lat:i[0].lat,lon:i[0].lng,zoom:this.options.permalinkZoom,bugid:e};this.options.permalinkUrl?m.href=L.Util.template(this.options.permalinkUrl,y):m.href=location.protocol+"//"+location.host+location.pathname+L.Util.getParamString(y),f._popup_content=a,f.bindPopup(a,this.options.popupOptions),f._popup.options.maxWidth=410,f._popup.options.minWidth=410,f.on("mouseover",f.openTempPopup,f)}},submitComment:function(e){if(e.osbcomment.value){var t=e.osbnickname.value||this.options.username;this.apiRequest("editPOIexec?id="+encodeURIComponent(e.osbid.value)+"&text="+encodeURIComponent(e.osbcomment.value+" ["+t+"]")+"&format=js",!0),this.set_cookie("osbUsername",t),this.options.username=t}},closeBug:function(e){var t=e.osbid.value;this.submitComment(e),this.apiRequest("closePOIexec?id="+encodeURIComponent(t)+"&format=js",!0)},createCommentForm:function(e){var t=L.DomUtil.create("form","osb-add-comment",e),n="";return n+='<input name="osbid" type="hidden"/>',n+='<input name="osblat" type="hidden"/>',n+='<input name="osblon" type="hidden"/>',n+='<div><span class="osb-inputlabel">'+L.i18n("Nickname")+':</span><input type="text" name="osbnickname"></div>',n+='<div><span class="osb-inputlabel">'+L.i18n("Comment")+':</span><input type="text" name="osbcomment"></div>',n+='<div class="osb-formfooter"><input type="submit" name="ok"/><input type="button" name="cancel"/></div>',t.innerHTML=n,t.ok.value=L.i18n("OK"),t.cancel.value=L.i18n("Cancel"),t.osbnickname.value=this.options.username,t},addBug:function(e){var t=L.DomUtil.create("div","osb-popup");t.innerHTML+="<h1>"+L.i18n("New bug")+"</h1>",t.innerHTML+='<div class="osbCreateInfo">'+L.i18n("Find your bug?")+"<br />"+L.i18n("Contact details and someone will fix it.")+"</div>";var n=new L.Popup,i=this,o=this.createCommentForm(t);o.osblat.value=e.latlng.lat,o.osblon.value=e.latlng.lng,o.ok.value=L.i18n("Add comment"),o.onsubmit=function(e){return i._map.closePopup(n),i.createBug(o),!1},o.cancel.onclick=function(e){i._map.closePopup(n)},n.setLatLng(e.latlng),n.setContent(t),n.options.maxWidth=410,n.options.minWidth=410,n.options.className+=" osb osbCreate",this._map.openPopup(n)},createBug:function(e){if(e.osbcomment.value){var t=e.osbnickname.value||this.options.username;this.apiRequest("addPOIexec?lat="+encodeURIComponent(e.osblat.value)+"&lon="+encodeURIComponent(e.osblon.value)+"&text="+encodeURIComponent(e.osbcomment.value+" ["+t+"]")+"&format=js",!0),this.set_cookie("osbUsername",t),this.options.username=t}},remoteEdit:function(e){var t=this.options.editArea||.01,n=2*t,i=["left="+(e.lng-n),"bottom="+(e.lat-t),"right="+(e.lng+n),"top="+(e.lat+t)],o="http://localhost:8111/load_and_zoom?"+i.join("&"),a=L.DomUtil.create("iframe",null);return a.style.display="none",a.src=o,document.body.appendChild(a),a.onload=function(e){document.body.removeChild(a)},!1}}),L.OpenStreetBugs.setCSS=function(){if(!L.OpenStreetBugs.setCSS.done){L.OpenStreetBugs.setCSS.done=!0;var e=0,t=function(t,n){var i=document.styleSheets[0];i.addRule?i.addRule(t,n,e):i.insertRule(t+" { "+n+" }",e),i.style=L.Util.extend(i.style||{},n),e++};t(".osb-popup dl","margin:0; padding:0;"),t(".osb-popup dt","margin:0; padding:0; font-weight:bold; float:left; clear:left;"),t(".osb-popup dt:after",'content: ": ";'),t("* html .osb-popup dt","margin-right:1ex;"),t(".osb-popup dd","margin:0; padding:0;"),t(".osb-popup ul.buttons","list-style-type:none; padding:0; margin:0;"),t(".osb-popup ul.buttons li","display:inline; margin:0; padding:0;"),t(".osb-popup h3","font-size:1.2em; margin:.2em 0 .7em 0;")}},putAJAXMarker.layers=[],putAJAXMarker.bugs={},L.Marker.include({openTempPopup:function(){function e(){this.off("mouseout",t,this),this.off("click",e,this),this.on("click",this.openPopup,this)}function t(){e.call(this),this.closePopup()}this.openPopup(),this.off("click",this.openPopup,this),this.on("mouseout",t,this),this.on("click",e,this)}}),L.i18n=function(e){return(L.i18n.lang[L.i18n.current]||{})[e]||e},L.i18n.current="ru",L.i18n.lang={},L.i18n.extend=function(e,t){L.i18n.lang[e]=L.Util.extend(L.i18n.lang[e]||{},t)},L.i18n.extend("ru",{"Fixed Error":"Ошибка исправлена","Unresolved Error":"Неисправленная ошибка","Active Error":"Ошибка уточняется",Description:"Описание",Comment:"Описание","Add comment":"Дополнить","Mark as Fixed":"Исправлено",Link:"Ссылка",Cancel:"Отмена","New bug":"Я нашел ошибку","Find your bug?":"Нашли ошибку?","Contact details and someone will fix it.":"Напишите подробнее и кто-нибудь её исправит."}),L.GPX=L.FeatureGroup.extend({initialize:function(e,t){L.Util.setOptions(this,t),this._gpx=e,this._layers={},e&&this.addGPX(e,t,this.options.async)},loadXML:function(e,t,n,i){void 0===i&&(i=this.options.async),void 0===n&&(n=this.options);var o=new window.XMLHttpRequest;o.open("GET",e,i);try{o.overrideMimeType("text/xml")}catch(e){}o.onreadystatechange=function(){4===o.readyState&&200===o.status&&t(o.responseXML,n)},o.send(null)},_humanLen:function(e){return e<2e3?e.toFixed(0)+" m":(e/1e3).toFixed(1)+" km"},_polylineLen:function(e){for(var t=e._latlngs,n=0,i=null,o=0;o<t.length;o++)o&&i&&(n+=i.distanceTo(t[o])),i=t[o];return n},addGPX:function(e,t,n){var i=this,o=function(e,t){i._addGPX(e,t)};this.loadXML(e,o,t,n)},_addGPX:function(e,t){var n=this.parseGPX(e,t);n&&(this.addLayer(n),this.fire("loaded"))},parseGPX:function(e,t){var n,i,o,a=[],r=!1,s=[["rte","rtept"],["trkseg","trkpt"]];for(n=0;n<s.length;n++)for(o=e.getElementsByTagName(s[n][0]),i=0;i<o.length;i++)for(var l=this.parse_trkseg(o[i],e,t,s[n][1]),u=0;u<l.length;u++)this.parse_name(o[i],l[u])&&(r=!0),a.push(l[u]);if(o=e.getElementsByTagName("wpt"),!1!==t.display_wpt)for(i=0;i<o.length;i++){var p=this.parse_wpt(o[i],e,t);p&&(this.parse_name(o[i],p)&&(r=!0),a.push(p))}if(a.length){var h=a[0];return a.length>1&&(h=new L.FeatureGroup(a)),r||this.parse_name(e,h),h}},parse_name:function(e,t){var n,i,o,a,r="",s="",l=0;for(i=e.getElementsByTagName("name"),i.length&&(o=i[0].childNodes[0].nodeValue),i=e.getElementsByTagName("desc"),n=0;n<i.length;n++)for(var u=0;u<i[n].childNodes.length;u++)s+=i[n].childNodes[u].nodeValue;return i=e.getElementsByTagName("link"),i.length&&(a=i[0].getAttribute("href")),t instanceof L.Path&&(l=this._polylineLen(t)),o&&(r+="<h2>"+o+"</h2>"+s),l&&(r+="<p>"+this._humanLen(l)+"</p>"),a&&(r+='<p><a target="_blank" href="'+a+'">[...]</a></p>'),t&&void 0===t._popup&&t.bindPopup(r),r},parse_trkseg:function(e,t,n,i){var o=e.getElementsByTagName(i);if(!o.length)return[];for(var a=[],r=0;r<o.length;r++){var s=new L.LatLng(o[r].getAttribute("lat"),o[r].getAttribute("lon"));s.meta={};for(var l in o[r].childNodes){var u=o[r].childNodes[l];u.tagName&&(s.meta[u.tagName]=u.textContent)}a.push(s)}var p=[new L.Polyline(a,n)];return this.fire("addline",{line:p}),p},parse_wpt:function(e,t,n){for(var i=new L.Marker(new L.LatLng(e.getAttribute("lat"),e.getAttribute("lon")),n),o={},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];"#text"!==r.nodeName&&(o[r.nodeName]=r.textContent)}return this.fire("addpoint",{point:i,attributes:o}),i}}),function(){function e(e){var t="";for(e=Math.floor(e);0!==e;)t="0123456789ABCDEF"[e%16]+t,e=Math.floor(e/16);for(;t.length<2;)t="0"+t;return t}function t(t){function n(t){return e(256*t)}return t<0?"#FF0000":t<1/3?"#FF"+n(3*t)+"00":t<2/3?"#"+n(2-3*t)+"FF00":t<1?"#00FF"+n(3*t-2):"#00FFFF"}function n(e){return 20!==e.length?new Date:new Date(e)}L.GPX.include({options:{maxSpeed:110,chunks:200},speedSplitEnable:function(e){return L.Util.setOptions(this,e),this.on("addline",this.speed_split,this)},speedSplitDisable:function(){return this.off("addline",this.speed_split,this)},speed_split:function(e){var i=e.line.pop(),o=i.getLatLngs(),a=Math.floor(o.length/this.options.chunks);a<3&&(a=3);for(var r=null,s=0;s<o.length;s+=a){var l=0,u=null;s+a>o.length&&(a=o.length-s);for(var p=0;p<a;p++)r&&(l+=r.distanceTo(o[s+p])),r=o[s+p],u||(u=n(r.meta.time));r=o[s+a-1],u=(n(r.meta.time)-u)/36e5;var h=.001*l/u,c=t(h/this.options.maxSpeed),d=new L.Polyline(o.slice(s,s+a+1),{color:c,weight:2,opacity:1});d.bindPopup("Dist: "+l.toFixed()+"m; Speed: "+h.toFixed(2)+" km/h"),e.line.push(d)}}})}(),L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(e,t){L.Util.setOptions(this,t),this._kml=e,this._layers={},e&&this.addKML(e,t,this.options.async)},loadXML:function(e,t,n,i){void 0===i&&(i=this.options.async),void 0===n&&(n=this.options);var o=new window.XMLHttpRequest;if(void 0===o.withCredentials&&void 0!==window.XDomainRequest){var a=new window.XDomainRequest;a.open("GET",e,i),a.onprogress=function(){},a.ontimeout=function(){},a.onerror=function(){},a.onload=function(){if(a.responseText){var e=new window.ActiveXObject("Microsoft.XMLDOM");e.loadXML(a.responseText),t(e,n)}},setTimeout(function(){a.send()},0)}else{o.open("GET",e,i),o.setRequestHeader("Accept","application/vnd.google-earth.kml+xml");try{o.overrideMimeType("text/xml")}catch(e){}o.onreadystatechange=function(){4===o.readyState&&200===o.status&&t(o.responseXML,n)},o.send(null)}},addKML:function(e,t,n){var i=this,o=function(e){i._addKML(e)};this.loadXML(e,o,t,n)},_addKML:function(e){var t=L.KML.parseKML(e);if(t&&t.length){for(var n=0;n<t.length;n++)this.fire("addlayer",{layer:t[n]}),this.addLayer(t[n]);this.latLngs=L.KML.getLatLngs(e),this.fire("loaded")}},latLngs:[]}),L.Util.extend(L.KML,{parseKML:function(e){var t=this.parseStyles(e);this.parseStyleMap(e,t);for(var n,i=e.getElementsByTagName("Folder"),o=[],a=0;a<i.length;a++)this._check_folder(i[a])&&(n=this.parseFolder(i[a],t))&&o.push(n);i=e.getElementsByTagName("Placemark");for(var r=0;r<i.length;r++)this._check_folder(i[r])&&(n=this.parsePlacemark(i[r],e,t))&&o.push(n);i=e.getElementsByTagName("GroundOverlay");for(var s=0;s<i.length;s++)(n=this.parseGroundOverlay(i[s]))&&o.push(n);return o},_check_folder:function(e,t){for(e=e.parentNode;e&&"Folder"!==e.tagName;)e=e.parentNode;return!e||e===t},parseStyles:function(e){for(var t={},n=e.getElementsByTagName("Style"),i=0,o=n.length;i<o;i++){var a=this.parseStyle(n[i]);if(a){t["#"+a.id]=a}}return t},parseStyle:function(e){function t(e){for(var n={},i=0;i<e.childNodes.length;i++){var o=e.childNodes[i],a=o.tagName;if(s[a])if("hotSpot"===a)for(var l=0;l<o.attributes.length;l++)n[o.attributes[l].name]=o.attributes[l].nodeValue;else{var u=o.childNodes[0].nodeValue;"color"===a?(n.opacity=parseInt(u.substring(0,2),16)/255,n.color="#"+u.substring(6,8)+u.substring(4,6)+u.substring(2,4)):"width"===a?n.weight=u:"Icon"===a?(r=t(o),r.href&&(n.href=r.href)):"href"===a&&(n.href=u)}}return n}var n,i,o={},a={},r={},s={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0};return n=e.getElementsByTagName("LineStyle"),n&&n[0]&&(o=t(n[0])),n=e.getElementsByTagName("PolyStyle"),n&&n[0]&&(a=t(n[0])),a.color&&(o.fillColor=a.color),a.opacity&&(o.fillOpacity=a.opacity),n=e.getElementsByTagName("IconStyle"),n&&n[0]&&(r=t(n[0])),r.href&&(o.icon=new L.KMLIcon({iconUrl:r.href,shadowUrl:null,anchorRef:{x:r.x,y:r.y},anchorType:{x:r.xunits,y:r.yunits}})),i=e.getAttribute("id"),i&&o&&(o.id=i),o},parseStyleMap:function(e,t){for(var n=e.getElementsByTagName("StyleMap"),i=0;i<n.length;i++){var o,a,r,s=n[i];o=s.getElementsByTagName("key"),o&&o[0]&&(a=o[0].textContent),o=s.getElementsByTagName("styleUrl"),o&&o[0]&&(r=o[0].textContent),"normal"===a&&(t["#"+s.getAttribute("id")]=t[r])}},parseFolder:function(e,t){var n,i,o=[];n=e.getElementsByTagName("Folder");for(var a=0;a<n.length;a++)this._check_folder(n[a],e)&&(i=this.parseFolder(n[a],t))&&o.push(i);n=e.getElementsByTagName("Placemark");for(var r=0;r<n.length;r++)this._check_folder(n[r],e)&&(i=this.parsePlacemark(n[r],e,t))&&o.push(i);n=e.getElementsByTagName("GroundOverlay");for(var s=0;s<n.length;s++)this._check_folder(n[s],e)&&(i=this.parseGroundOverlay(n[s]))&&o.push(i);if(o.length)return 1===o.length?o[0]:new L.FeatureGroup(o)},parsePlacemark:function(e,t,n,i){var o,a,r,s,l,u=i||{};for(l=e.getElementsByTagName("styleUrl"),a=0;a<l.length;a++){var p=l[a].childNodes[0].nodeValue;for(var h in n[p])u[h]=n[p][h]}if(e.getElementsByTagName("Style")[0]){var c=this.parseStyle(e);if(c)for(s in c)u[s]=c[s]}var d=["MultiGeometry","MultiTrack","gx:MultiTrack"];for(o in d)for(l=e.getElementsByTagName(d[o]),a=0;a<l.length;a++)return this.parsePlacemark(l[a],t,n,u);var f=[],g=["LineString","Polygon","Point","Track","gx:Track"];for(r in g){var m=g[r];for(l=e.getElementsByTagName(m),a=0;a<l.length;a++){var y=this["parse"+m.replace(/gx:/,"")](l[a],t,u);y&&f.push(y)}}if(f.length){var _=f[0];f.length>1&&(_=new L.FeatureGroup(f));var v,b="";for(l=e.getElementsByTagName("name"),l.length&&l[0].childNodes.length&&(v=l[0].childNodes[0].nodeValue),l=e.getElementsByTagName("description"),a=0;a<l.length;a++)for(r=0;r<l[a].childNodes.length;r++)b+=l[a].childNodes[r].nodeValue;return v&&_.on("add",function(){_.bindPopup("<h2>"+v+"</h2>"+b)}),_}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(e,t,n){var i=this.parseCoords(e);if(i.length)return new L.Polyline(i,n)},parseTrack:function(e,t,n){var i=t.getElementsByTagName("gx:coord");0===i.length&&(i=t.getElementsByTagName("coord"));for(var o=[],a=0;a<i.length;a++)o=o.concat(this._read_gxcoords(i[a]));if(o.length)return new L.Polyline(o,n)},parsePoint:function(e,t,n){var i=e.getElementsByTagName("coordinates")
;if(i.length){var o=i[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(o[1],o[0]),n)}},parsePolygon:function(e,t,n){var i,o,a,r=[],s=[];for(i=e.getElementsByTagName("outerBoundaryIs"),o=0;o<i.length;o++)(a=this.parseCoords(i[o]))&&r.push(a);for(i=e.getElementsByTagName("innerBoundaryIs"),o=0;o<i.length;o++)(a=this.parseCoords(i[o]))&&s.push(a);if(r.length)return n.fillColor&&(n.fill=!0),1===r.length?new L.Polygon(r.concat(s),n):new L.MultiPolygon(r,n)},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),n=[],i=0;i<t.length;i++)n=n.concat(this._read_coords(t[i]));return n},_read_coords:function(e){var t,n="",i=[];for(t=0;t<e.childNodes.length;t++)n+=e.childNodes[t].nodeValue;for(n=n.split(/[\s\n]+/),t=0;t<n.length;t++){var o=n[t].split(",");o.length<2||i.push(new L.LatLng(o[1],o[0]))}return i},_read_gxcoords:function(e){var t="",n=[];return t=e.firstChild.nodeValue.split(" "),n.push(new L.LatLng(t[1],t[0])),n},parseGroundOverlay:function(e){function t(e){for(var n={},i={},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a],s=r.tagName;if(o[s]){var l=r.childNodes[0].nodeValue;"Icon"===s?(i=t(r),i.href&&(n.href=i.href)):"href"===s?n.href=l:"color"===s&&(n.opacity=parseInt(l.substring(0,2),16)/255,n.color="#"+l.substring(6,8)+l.substring(4,6)+l.substring(2,4))}}return n}var n=e.getElementsByTagName("LatLonBox")[0],i=new L.LatLngBounds([n.getElementsByTagName("south")[0].childNodes[0].nodeValue,n.getElementsByTagName("west")[0].childNodes[0].nodeValue],[n.getElementsByTagName("north")[0].childNodes[0].nodeValue,n.getElementsByTagName("east")[0].childNodes[0].nodeValue]),o={Icon:!0,href:!0,color:!0},a={};if(a=t(e),void 0!==n.getElementsByTagName("rotation")[0]){var r=n.getElementsByTagName("rotation")[0].childNodes[0].nodeValue;a.rotation=parseFloat(r)}return new L.RotatedImageOverlay(a.href,i,{opacity:a.opacity,angle:a.rotation})}}),L.KMLIcon=L.Icon.extend({_setIconStyles:function(e,t){L.Icon.prototype._setIconStyles.apply(this,[e,t]);var n=this.options;this.options.popupAnchor=[0,-.83*e.height],"fraction"===n.anchorType.x&&(e.style.marginLeft=-n.anchorRef.x*e.width+"px"),"fraction"===n.anchorType.y&&(e.style.marginTop=-(1-n.anchorRef.y)*e.height+1+"px"),"pixels"===n.anchorType.x&&(e.style.marginLeft=-n.anchorRef.x+"px"),"pixels"===n.anchorType.y&&(e.style.marginTop=n.anchorRef.y-e.height+1+"px")}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}}),L.RotatedImageOverlay=L.ImageOverlay.extend({options:{angle:0},_reset:function(){L.ImageOverlay.prototype._reset.call(this),this._rotate()},_animateZoom:function(e){L.ImageOverlay.prototype._animateZoom.call(this,e),this._rotate()},_rotate:function(){if(L.DomUtil.TRANSFORM)this._image.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var e=this.options.angle*(Math.PI/180),t=Math.cos(e),n=Math.sin(e);this._image.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+t+", M12="+-n+", M21="+n+", M22="+t+")"}},getBounds:function(){return this._bounds}}),L.OSM=L.FeatureGroup.extend({options:{async:!0,forceAll:!1},initialize:function(e,t){L.Util.setOptions(this,t),this._url=e,this._layers={},e&&this.addXML(e,t,this.options.async)},loadXML:function(e,t,n,i){void 0===i&&(i=this.options.async),void 0===n&&(n=this.options);var o=new window.XMLHttpRequest;o.open("GET",e,i),o.overrideMimeType("text/xml"),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&t(o.responseXML,n)},o.send(null)},addXML:function(e,t,n){var i=this,o=function(e,t){i._addXML(e,t)};this.loadXML(e,o,t,n)},_addXML:function(e,t){var n=this.parseOSM(e,t);n&&(this.addLayer(n),this.fire("loaded"))},parseOSM:function(e,t){var n,i,o,a=[],r={},s={},l=!1;for(i=e.getElementsByTagName("node"),n=0;n<i.length;n++){var u=this.parse_node(i[n],e,t);if(void 0!==u&&(r[u.osmid]=u,this.options.forceAll||u.tags.length)){var p=this.named_node(u,t);o||(o=p.getLatLng()),this.parse_name(p,u,"Node")&&(l=!0),a.push(p)}}for(i=e.getElementsByTagName("way"),n=0;n<i.length&&!(n>10);n++){var h=this.parse_way(i[n],r,t);h&&(o||(o=h.getLatLngs()[0]),this.parse_name(h,h,"Way")&&(l=!0),a.push(h),s[h.osmid]=h)}for(i=e.getElementsByTagName("relation"),n=0;n<i.length&&!(n>10);n++){var c=this.parse_relation(i[n],s,t);c&&(o||(o=c.getLatLngs()[0]),this.parse_name(c,c,"Relation")&&(l=!0),a.push(c))}if(a.length){var d=a[0];return a.length>1&&(d=new L.FeatureGroup(a)),l||this.parse_name(e,d),d.focusPoint=o,d}},parse_name:function(e,t,n){if(this.options.forceAll||t.tags&&t.tags.length){var i,o="<table>";for(i=0;i<t.tags.length;i++){var a=t.tags[i];o+="<tr><td>"+a.k+"</td><td>=</td><td>"+a.v+"</td></tr>"}return o+="</table>",o="<h2>"+n+" "+t.osmid+"</h2>"+o,e&&e.bindPopup(o),o}},parse_tags:function(e){for(var t=[],n=e.getElementsByTagName("tag"),i=0;i<n.length;i++)t.push({k:n[i].getAttribute("k"),v:n[i].getAttribute("v")});return t},parse_node:function(e){var t={osmid:e.getAttribute("id"),lat:e.getAttribute("lat"),lon:e.getAttribute("lon")};return t.ll=new L.LatLng(t.lat,t.lon),t.tags=this.parse_tags(e),t},parse_way:function(e,t,n){var i=e.getElementsByTagName("nd");if(i.length){for(var o=[],a=0;a<i.length;a++){var r=i[a].getAttribute("ref"),s=t[r];if(!s)return;o.push(s.ll)}var l=new L.Polyline(o,n);return l.tags=this.parse_tags(e),l.osmid=e.getAttribute("id"),l}},parse_relation:function(e,t,n){var i=e.getElementsByTagName("member");if(i.length){var o,a,r=[],s=this.parse_tags(e);for(a=0;a<s.length;a++)"type"===s[a].k&&(o=s[a].v);if("multipolygon"===o||"boundary"===o||"waterway"===o){for(a=0;a<i.length;a++){var l=i[a].getAttribute("type"),u=i[a].getAttribute("ref");if("way"===l){var p=t[u];if(!p)return;r.push(p)}}if(r.length){var h=new L.MultiPolyline(r,n);return h.tags=this.parse_tags(e),h.osmid=e.getAttribute("id"),h}}}},named_node:function(e,t){return new L.Marker(new L.LatLng(e.lat,e.lon),t)}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.topojson=e.topojson||{})}(this,function(e){"use strict";function t(){}function n(e){if(!e)return t;var n,i,o=e.scale[0],a=e.scale[1],r=e.translate[0],s=e.translate[1];return function(e,t){t||(n=i=0),e[0]=(n+=e[0])*o+r,e[1]=(i+=e[1])*a+s}}function i(e){if(!e)return t;var n,i,o=e.scale[0],a=e.scale[1],r=e.translate[0],s=e.translate[1];return function(e,t){t||(n=i=0);var l=Math.round((e[0]-r)/o),u=Math.round((e[1]-s)/a);e[0]=l-n,e[1]=u-i,n=l,i=u}}function o(e,t){for(var n,i=e.length,o=i-t;o<--i;)n=e[o],e[o++]=e[i],e[i]=n}function a(e,t){for(var n=0,i=e.length;n<i;){var o=n+i>>>1;e[o]<t?n=o+1:i=o}return n}function r(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return s(e,t)})}:s(e,t)}function s(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:l(e,t)};return null==t.id&&delete n.id,n}function l(e,t){function i(e,t){t.length&&t.pop();for(var n,i=h[e<0?~e:e],a=0,r=i.length;a<r;++a)t.push(n=i[a].slice()),p(n,a);e<0&&o(t,r)}function a(e){return e=e.slice(),p(e,0),e}function r(e){for(var t=[],n=0,o=e.length;n<o;++n)i(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function s(e){for(var t=r(e);t.length<4;)t.push(t[0].slice());return t}function l(e){return e.map(s)}function u(e){var t=e.type;return"GeometryCollection"===t?{type:t,geometries:e.geometries.map(u)}:t in c?{type:t,coordinates:c[t](e)}:null}var p=n(e.transform),h=e.arcs,c={Point:function(e){return a(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(a)},LineString:function(e){return r(e.arcs)},MultiLineString:function(e){return e.arcs.map(r)},Polygon:function(e){return l(e.arcs)},MultiPolygon:function(e){return e.arcs.map(l)}};return u(t)}function u(e,t){function n(t){var n,i=e.arcs[t<0?~t:t],o=i[0];return e.transform?(n=[0,0],i.forEach(function(e){n[0]+=e[0],n[1]+=e[1]})):n=i[i.length-1],t<0?[n,o]:[o,n]}function i(e,t){for(var n in e){var i=e[n];delete t[i.start],delete i.start,delete i.end,i.forEach(function(e){o[e<0?~e:e]=1}),s.push(i)}}var o={},a={},r={},s=[],l=-1;return t.forEach(function(n,i){var o,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(o=t[++l],t[l]=n,t[i]=o)}),t.forEach(function(e){var t,i,o=n(e),s=o[0],l=o[1];if(t=r[s])if(delete r[t.end],t.push(e),t.end=l,i=a[l]){delete a[i.start];var u=i===t?t:t.concat(i);a[u.start=t.start]=r[u.end=i.end]=u}else a[t.start]=r[t.end]=t;else if(t=a[l])if(delete a[t.start],t.unshift(e),t.start=s,i=r[s]){delete r[i.end];var p=i===t?t:i.concat(t);a[p.start=i.start]=r[p.end=t.end]=p}else a[t.start]=r[t.end]=t;else t=[e],a[t.start=s]=r[t.end=l]=t}),i(r,a),i(a,r),t.forEach(function(e){o[e<0?~e:e]||s.push([e])}),s}function p(e){return l(e,h.apply(this,arguments))}function h(e,t,n){function i(e){var t=e<0?~e:e;(p[t]||(p[t]=[])).push({i:e,g:l})}function o(e){e.forEach(i)}function a(e){e.forEach(o)}function r(e){"GeometryCollection"===e.type?e.geometries.forEach(r):e.type in h&&(l=e,h[e.type](e.arcs))}var s=[];if(arguments.length>1){var l,p=[],h={LineString:o,MultiLineString:a,Polygon:a,MultiPolygon:function(e){e.forEach(a)}};r(t),p.forEach(arguments.length<3?function(e){s.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&s.push(e[0].i)})}else for(var c=0,d=e.arcs.length;c<d;++c)s.push(c);return{type:"MultiLineString",arcs:u(e,s)}}function c(e){var t=e[0],n=e[1],i=e[2];return Math.abs((t[0]-i[0])*(n[1]-t[1])-(t[0]-n[0])*(i[1]-t[1]))}function d(e){for(var t,n=-1,i=e.length,o=e[i-1],a=0;++n<i;)t=o,o=e[n],a+=t[0]*o[1]-t[1]*o[0];return a/2}function f(e){return l(e,g.apply(this,arguments))}function g(e,t){function n(e){e.forEach(function(t){t.forEach(function(t){(o[t=t<0?~t:t]||(o[t]=[])).push(e)})}),a.push(e)}function i(t){return Math.abs(d(l(e,{type:"Polygon",arcs:[t]}).coordinates[0]))}var o={},a=[],r=[];return t.forEach(function(e){"Polygon"===e.type?n(e.arcs):"MultiPolygon"===e.type&&e.arcs.forEach(n)}),a.forEach(function(e){if(!e._){var t=[],n=[e];for(e._=1,r.push(t);e=n.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){o[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),a.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:r.map(function(t){var n,a=[];if(t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){o[e<0?~e:e].length<2&&a.push(e)})})}),a=u(e,a),(n=a.length)>1)for(var r,s,l=1,p=i(a[0]);l<n;++l)(r=i(a[l]))>p&&(s=a[0],a[0]=a[l],a[l]=s,p=r);return a})}}function m(e){function t(e,t){e.forEach(function(e){e<0&&(e=~e);var n=o[e];n?n.push(t):o[e]=[t]})}function n(e,n){e.forEach(function(e){t(e,n)})}function i(e,t){"GeometryCollection"===e.type?e.geometries.forEach(function(e){i(e,t)}):e.type in s&&s[e.type](e.arcs,t)}var o={},r=e.map(function(){return[]}),s={LineString:t,MultiLineString:n,Polygon:n,MultiPolygon:function(e,t){e.forEach(function(e){n(e,t)})}};e.forEach(i);for(var l in o)for(var u=o[l],p=u.length,h=0;h<p;++h)for(var c=h+1;c<p;++c){var d,f=u[h],g=u[c];(d=r[f])[l=a(d,g)]!==g&&d.splice(l,0,g),(d=r[g])[l=a(d,f)]!==f&&d.splice(l,0,f)}return r}function y(e,t){return e[1][2]-t[1][2]}function _(){function e(e,t){for(;t>0;){var n=(t+1>>1)-1,o=i[n];if(y(e,o)>=0)break;i[o._=t]=o,i[e._=t=n]=e}}function t(e,t){for(;;){var n=t+1<<1,a=n-1,r=t,s=i[r];if(a<o&&y(i[a],s)<0&&(s=i[r=a]),n<o&&y(i[n],s)<0&&(s=i[r=n]),r===t)break;i[s._=t]=s,i[e._=t=r]=e}}var n={},i=[],o=0;return n.push=function(t){return e(i[t._=o]=t,o++),o},n.pop=function(){if(!(o<=0)){var e,n=i[0];return--o>0&&(e=i[o],t(i[e._=0]=e,0)),n}},n.remove=function(n){var a,r=n._;if(i[r]===n)return r!==--o&&(a=i[o],(y(a,n)<0?e:t)(i[a._=r]=a,r)),r},n}function L(e,t){function o(e){s.remove(e),e[1][2]=t(e),s.push(e)}var a=n(e.transform),r=i(e.transform),s=_();return t||(t=c),e.arcs.forEach(function(e){var n,i,l,u,p=[],h=0;for(i=0,l=e.length;i<l;++i)u=e[i],a(e[i]=[u[0],u[1],1/0],i);for(i=1,l=e.length-1;i<l;++i)n=e.slice(i-1,i+2),n[1][2]=t(n),p.push(n),s.push(n);for(i=0,l=p.length;i<l;++i)n=p[i],n.previous=p[i-1],n.next=p[i+1];for(;n=s.pop();){var c=n.previous,d=n.next;n[1][2]<h?n[1][2]=h:h=n[1][2],c&&(c.next=d,c[2]=n[2],o(c)),d&&(d.previous=c,d[0]=n[0],o(d))}e.forEach(r)}),e}e.version="1.6.26",e.mesh=p,e.meshArcs=h,e.merge=f,e.mergeArcs=g,e.feature=r,e.neighbors=m,e.presimplify=L}),L.TOPOJSON=L.FeatureGroup.extend({options:{async:!0},initialize:function(e,t){L.Util.setOptions(this,t),this._topojson=e,this._layers={},e&&this.addTOPOJSON(e,t,this.options.async)},loadJSON:function(e,t,n,i){void 0===i&&(i=this.options.async),void 0===n&&(n=this.options);var o=new window.XMLHttpRequest;if(void 0===o.withCredentials&&void 0!==window.XDomainRequest){var a=new window.XDomainRequest;a.open("GET",e,i),a.onprogress=function(){},a.ontimeout=function(){},a.onerror=function(){},a.onload=function(){a.responseText&&t(a.responseText,n)},setTimeout(function(){a.send()},0)}else{o.open("GET",e,i);try{o.overrideMimeType("application/json")}catch(e){}o.onreadystatechange=function(){4===o.readyState&&200===o.status&&t(o.response,n)},o.send(null)}},addTOPOJSON:function(e,t,n){var i=this,o=function(e){i._addTOPOJSON(e)};this.loadJSON(e,o,t,n)},_addTOPOJSON:function(e){var t=this.parseTOPOJSON(e);if(t&&t.length){for(var n=0;n<t.length;n++)this.fire("addlayer",{layer:t[n]}),this.addLayer(t[n]);this.fire("loaded")}},_addData:function(e,t){"addData"in e&&e.addData(t),"setGeoJSON"in e&&e.setGeoJSON(t)},parseTOPOJSON:function(e){var t=[],n="string"==typeof e?JSON.parse(e):e;for(var i in n.objects){var o=L.geoJson(),a=topojson.feature(n,n.objects[i]);a.features?this._addData(o,a.features):_this._addData(o,a),t.push(o)}return t}}),L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(e,t){L.Util.setOptions(this,t),this._key=e,this._url=null,this._providers=[],this.metaRequested=!1},tile2quad:function(e,t,n){for(var i="",o=n;o>0;o--){var a=0,r=1<<o-1;0!=(e&r)&&(a+=1),0!=(t&r)&&(a+=2),i+=a}return i},getTileUrl:function(e){var t=this._getZoomForUrl(),n=this.options.subdomains,i=this.options.subdomains[Math.abs((e.x+e.y)%n.length)];return this._url.replace("{subdomain}",i).replace("{quadkey}",this.tile2quad(e.x,e.y,t)).replace("{culture}",this.options.culture)},loadMetadata:function(){if(!this.metaRequested){this.metaRequested=!0;var e=this,t="_bing_metadata_"+L.Util.stamp(this);window[t]=function(n){window[t]=void 0;var i=document.getElementById(t);if(i.parentNode.removeChild(i),n.errorDetails)throw new Error(n.errorDetails);e.initMetadata(n)};var n="file:"===document.location.protocol?"http":document.location.protocol.slice(0,-1),i=n+"://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+t+"&key="+this._key+"&UriScheme="+n,o=document.createElement("script");o.type="text/javascript",o.src=i,o.id=t,document.getElementsByTagName("head")[0].appendChild(o)}},initMetadata:function(e){var t=e.resourceSets[0].resources[0];if(this.options.subdomains=t.imageUrlSubdomains,this._url=t.imageUrl,t.imageryProviders)for(var n=0;n<t.imageryProviders.length;n++)for(var i=t.imageryProviders[n],o=0;o<i.coverageAreas.length;o++){var a=i.coverageAreas[o],r={zoomMin:a.zoomMin,zoomMax:a.zoomMax,active:!1},s=new L.LatLngBounds(new L.LatLng(a.bbox[0]+.01,a.bbox[1]+.01),new L.LatLng(a.bbox[2]-.01,a.bbox[3]-.01));r.bounds=s,r.attrib=i.attribution,this._providers.push(r)}this._update()},_update:function(){null!==this._url&&this._map&&(this._update_attribution(),L.TileLayer.prototype._update.apply(this,[]))},_update_attribution:function(){for(var e=L.latLngBounds(this._map.getBounds().getSouthWest().wrap(),this._map.getBounds().getNorthEast().wrap()),t=this._map.getZoom(),n=0;n<this._providers.length;n++){var i=this._providers[n];t<=i.zoomMax&&t>=i.zoomMin&&e.intersects(i.bounds)?(!i.active&&this._map.attributionControl&&this._map.attributionControl.addAttribution(i.attrib),i.active=!0):(i.active&&this._map.attributionControl&&this._map.attributionControl.removeAttribution(i.attrib),i.active=!1)}},onAdd:function(e){this.loadMetadata(),L.TileLayer.prototype.onAdd.apply(this,[e])},onRemove:function(e){for(var t=0;t<this._providers.length;t++){var n=this._providers[t];n.active&&this._map.attributionControl&&(this._map.attributionControl.removeAttribution(n.attrib),n.active=!1)}L.TileLayer.prototype.onRemove.apply(this,[e])}}),L.bingLayer=function(e,t){return new L.BingLayer(e,t)},L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(e,t){L.Util.setOptions(this,t),this._ready=void 0!==google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=e||"SATELLITE"},onAdd:function(e,t){this._map=e,this._insertAtTheBottom=t,this._initContainer(),this._initMapObject(),e.on("viewreset",this._reset,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),e.on("move",this._update,this),e.on("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(e){e._container.removeChild(this._container),e.off("viewreset",this._reset,this),e.off("move",this._update,this),e.off("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e,e<1&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),e.insertBefore(this._container,t),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),t=this;this._reposition=google.maps.event.addListenerOnce(e,"center_changed",function(){t.onReposition()}),this._google=e,google.maps.event.addListenerOnce(e,"idle",function(){t._checkZoomLevels()}),google.maps.event.addListenerOnce(e,"tilesloaded",function(){t.fire("load")}),this.fire("MapObjectInitialized",{mapObject:e})}},_checkZoomLevels:function(){void 0!==this._map.getZoom()&&this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_reset:function(){this._initContainer()},_update:function(){if(this._google){this._resize();var e=this._map.getCenter(),t=new google.maps.LatLng(e.lat,e.lng);this._google.setCenter(t),void 0!==this._map.getZoom()&&this._google.setZoom(Math.round(this._map.getZoom())),this._checkZoomLevels()}},_resize:function(){var e=this._map.getSize();this._container.style.width===e.x&&this._container.style.height===e.y||(this.setElementSize(this._container,e),this.onReposition())},_handleZoomAnim:function(e){var t=e.center,n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n),this._google.setZoom(Math.round(e.zoom))},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var e;for(e=0;e<L.Google.asyncWait.length;e++){var t=L.Google.asyncWait[e];t._ready=!0,t._container&&(t._initMapObject(),t._update())}L.Google.asyncWait=[]},L.Yandex=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1},possibleShortMapTypes:{schemaMap:"map",satelliteMap:"satellite",hybridMap:"hybrid",publicMap:"publicMap",publicMapInHybridView:"publicMapHybrid"},_getPossibleMapType:function(e){var t="yandex#map";if("string"!=typeof e)return t;for(var n in this.possibleShortMapTypes){if(e===this.possibleShortMapTypes[n]){t="yandex#"+e;break}e==="yandex#"+this.possibleShortMapTypes[n]&&(t=e)}return t},initialize:function(e,t){L.Util.setOptions(this,t),this._type=this._getPossibleMapType(e)},onAdd:function(e,t){this._map=e,this._insertAtTheBottom=t,this._initContainer(),this._initMapObject(),e.on("viewreset",this._reset,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),e.on("move",this._update,this),e._controlCorners.bottomright.style.marginBottom="3em",this._reset(),this._update(!0)},onRemove:function(e){this._map._container.removeChild(this._container),this._map.off("viewreset",this._reset,this),this._map.off("move",this._update,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e,e<1&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left"),this._container.id="_YMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),this.options.overlay&&(t=this._map._container.getElementsByClassName("leaflet-map-pane")[0],t=t.nextSibling,L.Browser.opera&&(this._container.className+=" leaflet-objects-pane")),e.insertBefore(this._container,t),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._yandex){if(void 0===ymaps.Map)return ymaps.load(["package.map"],this._initMapObject,this);if(this.options.traffic&&(void 0===ymaps.control||void 0===ymaps.control.TrafficControl))return ymaps.load(["package.traffic","package.controls"],this._initMapObject,this);var e=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[],controls:[]});this.options.traffic&&e.controls.add(new ymaps.control.TrafficControl({shown:!0})),"yandex#null"===this._type&&(this._type=new ymaps.MapType("null",[]),e.container.getElement().style.background="transparent"),e.setType(this._type),this._yandex=e,this._update(!0),this.fire("MapObjectInitialized",{mapObject:e})}},_reset:function(){this._initContainer()},_update:function(e){if(this._yandex){this._resize(e);var t=this._map.getCenter(),n=[t.lat,t.lng],i=this._map.getZoom();(e||this._yandex.getZoom()!==i)&&this._yandex.setZoom(i),this._yandex.panTo(n,{duration:0,delay:0})}},_resize:function(e){var t=this._map.getSize(),n=this._container.style;n.width===t.x+"px"&&n.height===t.y+"px"&&!0!==e||(this.setElementSize(this._container,t),this._yandex.container.fitToViewport())}}),function(window,angular){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("ui-leaflet").config(["$provide",function(e){return e.decorator("leafletHelpers",["$delegate","leafletLayersLogger",function(e,t){var n=t,i=function(e,t){if((void 0===e?"undefined":_typeof(e))+(void 0===t?"undefined":_typeof(t))!=="stringstring")return!1;for(var n=e.split("."),i=t.split("."),o=0,a=Math.max(n.length,i.length);o<a;o++){if(n[o]&&!i[o]&&parseInt(n[o])>0||parseInt(n[o])>parseInt(i[o]))return 1;if(i[o]&&!n[o]&&parseInt(i[o])>0||parseInt(n[o])<parseInt(i[o]))return-1}return 0},o=function(e){return{isLoaded:function(){return angular.isDefined(e)},is:function(t){return!!this.isLoaded()&&t instanceof e}}},a={BingLayerPlugin:o(L.BingLayer),ChinaLayerPlugin:o(L.tileLayer.chinaProvider),HeatLayerPlugin:o(L.heatLayer),LeafletProviderPlugin:o(L.TileLayer.Provider),MapboxGL:o(L.mapboxGL),UTFGridPlugin:o(L.UtfGrid),WebGLHeatMapLayerPlugin:o(L.TileLayer.WebGLHeatMap),WFSLayerPlugin:o(L.GeoJSON.WFS),YandexLayerPlugin:o(L.Yandex)};return-1===i(L.version,"1.0.0")?a.GoogleLayerPlugin=o(L.Google):a.GoogleLayerPlugin=o(L.GridLayer.GoogleMutant),a.versionCompare=i,angular.isDefined(L.esri)?angular.extend(a,{AGSBaseLayerPlugin:o(L.esri.basemapLayer),AGSClusteredLayerPlugin:o(L.esri.clusteredFeatureLayer),AGSDynamicMapLayerPlugin:o(L.esri.dynamicMapLayer),AGSFeatureLayerPlugin:o(L.esri.featureLayer),AGSImageMapLayerPlugin:o(L.esri.imageMapLayer),AGSHeatmapLayerPlugin:o(L.esri.heatmapFeatureLayer),AGSTiledMapLayerPlugin:o(L.esri.tiledMapLayer)}):angular.extend(a,{AGSBaseLayerPlugin:o(),AGSClusteredLayerPlugin:o(),AGSDynamicMapLayerPlugin:o(),AGSFeatureLayerPlugin:o(),AGSImageMapLayerPlugin:o(),AGSHeatmapLayerPlugin:o(),AGSTiledMapLayerPlugin:o()}),angular.isDefined(window.lvector)?angular.extend(a,{AGSLayerPlugin:o(window.lvector.AGS)}):angular.extend(a,{AGSLayerPlugin:o()}),angular.extend(e,a),n.info("[ui-leaflet-layers] - Layers plugin is loaded"),e}])}]),angular.module("ui-leaflet").config(["$provide",function($provide){return $provide.decorator("leafletLayerHelpers",["$delegate","$rootScope","$q","leafletHelpers","leafletLayersLogger",function($delegate,$rootScope,$q,leafletHelpers,leafletLayersLogger){var $log=leafletLayersLogger,isArray=leafletHelpers.isArray,isObject=leafletHelpers.isObject,isDefined=leafletHelpers.isDefined,errorHeader=leafletHelpers.errorHeader,utfGridCreateLayer=function(e){if(!leafletHelpers.UTFGridPlugin.isLoaded())return void $log.error(errorHeader+" The UTFGrid plugin is not loaded.");var t=new L.UtfGrid(e.url,e.pluginOptions);return t.on("mouseover",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseover",e)}),t.on("mouseout",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseout",e)}),t.on("click",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridClick",e)}),t.on("mousemove",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMousemove",e)}),t};return angular.extend($delegate.layerTypes,{ags:{mustHaveUrl:!0,createLayer:function(e){if(leafletHelpers.AGSLayerPlugin.isLoaded()){var t=angular.copy(e.options);angular.extend(t,{url:e.url});var n=new lvector.AGS(t);return n.onAdd=function(e){this.setMap(e)},n.onRemove=function(){this.setMap(null)},n}}},agsBase:{mustHaveLayer:!0,createLayer:function(e){if(leafletHelpers.AGSBaseLayerPlugin.isLoaded())return L.esri.basemapLayer(e.layer,e.options)}},agsClustered:{mustHaveUrl:!0,createLayer:function(e){return leafletHelpers.AGSClusteredLayerPlugin.isLoaded()?leafletHelpers.MarkerClusterPlugin.isLoaded()?L.esri.clusteredFeatureLayer(e.url,e.options):void $log.warn(errorHeader+" The markercluster plugin is not loaded."):void $log.warn(errorHeader+" The esri clustered layer plugin is not loaded.")}},agsDynamic:{mustHaveUrl:!0,createLayer:function(e){return leafletHelpers.AGSDynamicMapLayerPlugin.isLoaded()?(e.options.url=e.url,L.esri.dynamicMapLayer(e.options)):void $log.warn(errorHeader+" The esri plugin is not loaded.")}},agsFeature:{mustHaveUrl:!0,createLayer:function(e){if(!leafletHelpers.AGSFeatureLayerPlugin.isLoaded())return void $log.warn(errorHeader+" The esri plugin is not loaded.");e.options.url=e.url;var t=L.esri.featureLayer(e.options),n=function(){isDefined(e.options.loadedDefer)&&e.options.loadedDefer.resolve()};return t.on("loading",function(){e.options.loadedDefer=$q.defer(),t.off("load",n),t.on("load",n)}),t}},agsHeatmap:{mustHaveUrl:!0,createLayer:function(e){return leafletHelpers.AGSHeatmapLayerPlugin.isLoaded()?leafletHelpers.HeatLayerPlugin.isLoaded()?L.esri.heatmapFeatureLayer(e.url,e.options):void $log.warn(errorHeader+" The heatlayer plugin is not loaded."):void $log.warn(errorHeader+" The esri heatmap layer plugin is not loaded.")}},agsImage:{mustHaveUrl:!0,createLayer:function(e){return leafletHelpers.AGSImageMapLayerPlugin.isLoaded()?(e.options.url=e.url,L.esri.imageMapLayer(e.options)):void $log.warn(errorHeader+" The esri plugin is not loaded.")}},agsTiled:{mustHaveUrl:!0,createLayer:function(e){return leafletHelpers.AGSTiledMapLayerPlugin.isLoaded()?(e.options.url=e.url,L.esri.tiledMapLayer(e.options)):void $log.warn(errorHeader+" The esri plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(e){return leafletHelpers.BingLayerPlugin.isLoaded()?new L.BingLayer(e.key,e.options):void $log.error(errorHeader+" The Bing plugin is not loaded.")}},china:{mustHaveUrl:!1,createLayer:function(e){var t=e.type||"";return leafletHelpers.ChinaLayerPlugin.isLoaded()?L.tileLayer.chinaProvider(t,e.options):void $log.error(errorHeader+" The ChinaLayer plugin is not loaded.")}},google:{mustHaveUrl:!1,createLayer:function(e){var t=e.type||"SATELLITE";if(!leafletHelpers.GoogleLayerPlugin.isLoaded())return void $log.error(errorHeader+" The GoogleLayer plugin is not loaded.");return-1===leafletHelpers.versionCompare(L.version,"1.0.0")?new L.Google(t.toUpperCase(),e.options):new L.GridLayer.GoogleMutant({type:t.toLowerCase()})}},heat:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(e){if(!leafletHelpers.HeatLayerPlugin.isLoaded())return void $log.error(errorHeader+" The HeatMapLayer plugin is not loaded.");var t=new L.heatLayer;return isArray(e.data)&&t.setLatLngs(e.data),isObject(e.options)&&t.setOptions(e.options),t}},here:{mustHaveUrl:!1,createLayer:function(e){var t=e.provider||"HERE.terrainDay";if(leafletHelpers.LeafletProviderPlugin.isLoaded())return new L.TileLayer.Provider(t,e.options)}},mapbox:{mustHaveKey:!0,createLayer:function(e){return L.tileLayer("//api.mapbox.com/styles/v1/{user}/{mapId}/tiles/256/{z}/{x}/{y}?access_token={apiKey}",angular.extend(e.options,{mapId:e.key,user:e.user,apiKey:e.apiKey}))}},mapboxGL:{createLayer:function(e){return leafletHelpers.MapboxGL.isLoaded()?new L.mapboxGL(e.options):void $log.error(errorHeader+" The MapboxGL plugin is not loaded.")}},utfGrid:{mustHaveUrl:!0,createLayer:utfGridCreateLayer},webGLHeatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(e){if(!leafletHelpers.WebGLHeatMapLayerPlugin.isLoaded())return void $log.error(errorHeader+" The WebGLHeatMapLayer plugin is not loaded.");var t=new L.TileLayer.WebGLHeatMap(e.options);return isDefined(e.data)&&t.setData(e.data),t}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function createLayer(params){if(!leafletHelpers.WFSLayerPlugin.isLoaded())return void $log.error(errorHeader+" The WFSLayer plugin is not loaded.");var options=angular.copy(params.options);return options.crs&&"string"==typeof options.crs&&(options.crs=eval(options.crs)),new L.GeoJSON.WFS(params.url,params.layer,options)}},yandex:{mustHaveUrl:!1,createLayer:function(e){var t=e.type||"map";return leafletHelpers.YandexLayerPlugin.isLoaded()?new L.Yandex(t,e.options):void $log.error(errorHeader+" The YandexLayer plugin is not loaded.")}}}),$delegate}])}]),angular.module("ui-leaflet").service("leafletLayersLogger",["nemSimpleLogger",function(e){return e.spawn()}])}(window,angular);